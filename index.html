<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <title>Document</title>
  </head>
  <body>
    <input type="file" onchange="importFile(this)" />
    <div id="demo"></div>
    <script>
      let wb; //读取完成的数据
      function importFile(obj) {
        const f = obj.files[0];
        const reader = new FileReader();
        reader.onload = function (e) {
          var data = e.target.result;
          wb = XLSX.read(data, {
            type: "binary", //以二进制的方式读取
          });
          //wb.SheetNames[0]是获取Sheets中第一个Sheet的名字
          //wb.Sheets[Sheet名]获取第一个Sheet的数据
          // XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]], { raw: false }); //以字符串形式读取。
          const table = XLSX.utils.sheet_to_json(wb.Sheets[wb.SheetNames[0]]);
          let arr = [];
          for (let i = 0; i < table.length; i++) {
            for (const key in table[i]) {
              if (key != "__EMPTY") arr.push(...table[i][key].split("\n"));
            }
          }
          arr = arr.filter((item) => item);
          const user = {};
          for (let i = 0; i < arr.length; i++) {
            const key = arr[i].split("-")[0];
            user[key] = (user[key] || 0) + 1;
          }
          let str = "";
          for (const key in user) {
            str += `${key}: ${user[key]}<br>`;
          }
          document.getElementById("demo").innerHTML = JSON.stringify(str);
        };
        reader.readAsBinaryString(f);
      }
    </script>
  </body>
</html>
